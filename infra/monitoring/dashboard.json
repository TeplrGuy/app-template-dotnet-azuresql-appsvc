{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "metadata": {
        "title": "Contoso University - Resilience Monitoring Dashboard",
        "description": "Azure Monitor dashboard for observing application health, performance, and chaos experiment impact"
    },
    "parameters": {
        "dashboardName": {
            "type": "string",
            "defaultValue": "contoso-resilience-dashboard",
            "metadata": {
                "description": "Name of the Azure Dashboard"
            }
        },
        "location": {
            "type": "string",
            "defaultValue": "[resourceGroup().location]",
            "metadata": {
                "description": "Location for the dashboard"
            }
        },
        "appInsightsResourceId": {
            "type": "string",
            "metadata": {
                "description": "Resource ID of Application Insights"
            }
        },
        "appServiceResourceId": {
            "type": "string",
            "metadata": {
                "description": "Resource ID of App Service"
            }
        },
        "sqlDatabaseResourceId": {
            "type": "string",
            "metadata": {
                "description": "Resource ID of Azure SQL Database"
            }
        }
    },
    "variables": {
        "dashboardId": "[resourceId('Microsoft.Portal/dashboards', parameters('dashboardName'))]"
    },
    "resources": [
        {
            "type": "Microsoft.Portal/dashboards",
            "apiVersion": "2020-09-01-preview",
            "name": "[parameters('dashboardName')]",
            "location": "[parameters('location')]",
            "tags": {
                "hidden-title": "Contoso University - Resilience Dashboard",
                "purpose": "chaos-engineering",
                "application": "contoso-university"
            },
            "properties": {
                "lenses": [
                    {
                        "order": 0,
                        "parts": [
                            {
                                "position": {
                                    "x": 0,
                                    "y": 0,
                                    "colSpan": 6,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                    "settings": {
                                        "content": {
                                            "content": "# üéØ Contoso University - Resilience Dashboard\n\nMonitor application health and observe impact during chaos experiments.",
                                            "title": "",
                                            "subtitle": "",
                                            "markdownSource": 1
                                        }
                                    }
                                }
                            },
                            {
                                "position": {
                                    "x": 6,
                                    "y": 0,
                                    "colSpan": 3,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                    "settings": {
                                        "content": {
                                            "content": "### üî• Chaos Status\n**Last Experiment:** _Check Azure Chaos Studio_",
                                            "title": "",
                                            "subtitle": "",
                                            "markdownSource": 1
                                        }
                                    }
                                }
                            },
                            {
                                "position": {
                                    "x": 0,
                                    "y": 1,
                                    "colSpan": 3,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "type": "Extension/Microsoft_Azure_Monitoring/PartType/MetricsChartPart",
                                    "settings": {
                                        "chartSettings": {
                                            "title": "üìä Response Time (p95)",
                                            "visualization": {
                                                "chartType": 2
                                            },
                                            "resourceId": "[parameters('appInsightsResourceId')]",
                                            "timeContext": {
                                                "durationMs": 3600000,
                                                "grain": 60000
                                            },
                                            "metrics": [
                                                {
                                                    "resourceMetadata": {
                                                        "id": "[parameters('appInsightsResourceId')]"
                                                    },
                                                    "name": "requests/duration",
                                                    "aggregationType": "Percentile",
                                                    "percentile": 95,
                                                    "displayName": "p95 Response Time"
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "position": {
                                    "x": 3,
                                    "y": 1,
                                    "colSpan": 3,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "type": "Extension/Microsoft_Azure_Monitoring/PartType/MetricsChartPart",
                                    "settings": {
                                        "chartSettings": {
                                            "title": "üö¶ Request Rate & Failures",
                                            "visualization": {
                                                "chartType": 2
                                            },
                                            "resourceId": "[parameters('appInsightsResourceId')]",
                                            "timeContext": {
                                                "durationMs": 3600000,
                                                "grain": 60000
                                            },
                                            "metrics": [
                                                {
                                                    "resourceMetadata": {
                                                        "id": "[parameters('appInsightsResourceId')]"
                                                    },
                                                    "name": "requests/count",
                                                    "aggregationType": "Sum",
                                                    "displayName": "Total Requests"
                                                },
                                                {
                                                    "resourceMetadata": {
                                                        "id": "[parameters('appInsightsResourceId')]"
                                                    },
                                                    "name": "requests/failed",
                                                    "aggregationType": "Sum",
                                                    "displayName": "Failed Requests"
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "position": {
                                    "x": 6,
                                    "y": 1,
                                    "colSpan": 3,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "type": "Extension/Microsoft_Azure_Monitoring/PartType/MetricsChartPart",
                                    "settings": {
                                        "chartSettings": {
                                            "title": "üíª App Service CPU",
                                            "visualization": {
                                                "chartType": 2
                                            },
                                            "resourceId": "[parameters('appServiceResourceId')]",
                                            "timeContext": {
                                                "durationMs": 3600000,
                                                "grain": 60000
                                            },
                                            "metrics": [
                                                {
                                                    "resourceMetadata": {
                                                        "id": "[parameters('appServiceResourceId')]"
                                                    },
                                                    "name": "CpuPercentage",
                                                    "aggregationType": "Average",
                                                    "displayName": "CPU %"
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "position": {
                                    "x": 0,
                                    "y": 4,
                                    "colSpan": 3,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "type": "Extension/Microsoft_Azure_Monitoring/PartType/MetricsChartPart",
                                    "settings": {
                                        "chartSettings": {
                                            "title": "üóÑÔ∏è Database DTU",
                                            "visualization": {
                                                "chartType": 2
                                            },
                                            "resourceId": "[parameters('sqlDatabaseResourceId')]",
                                            "timeContext": {
                                                "durationMs": 3600000,
                                                "grain": 60000
                                            },
                                            "metrics": [
                                                {
                                                    "resourceMetadata": {
                                                        "id": "[parameters('sqlDatabaseResourceId')]"
                                                    },
                                                    "name": "dtu_consumption_percent",
                                                    "aggregationType": "Average",
                                                    "displayName": "DTU %"
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "position": {
                                    "x": 3,
                                    "y": 4,
                                    "colSpan": 3,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "type": "Extension/Microsoft_Azure_Monitoring/PartType/MetricsChartPart",
                                    "settings": {
                                        "chartSettings": {
                                            "title": "‚è±Ô∏è Database Query Duration",
                                            "visualization": {
                                                "chartType": 2
                                            },
                                            "resourceId": "[parameters('appInsightsResourceId')]",
                                            "timeContext": {
                                                "durationMs": 3600000,
                                                "grain": 60000
                                            },
                                            "metrics": [
                                                {
                                                    "resourceMetadata": {
                                                        "id": "[parameters('appInsightsResourceId')]"
                                                    },
                                                    "name": "dependencies/duration",
                                                    "aggregationType": "Average",
                                                    "displayName": "Dependency Duration"
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "position": {
                                    "x": 6,
                                    "y": 4,
                                    "colSpan": 3,
                                    "rowSpan": 3
                                },
                                "metadata": {
                                    "type": "Extension/Microsoft_Azure_Monitoring/PartType/MetricsChartPart",
                                    "settings": {
                                        "chartSettings": {
                                            "title": "üß† App Service Memory",
                                            "visualization": {
                                                "chartType": 2
                                            },
                                            "resourceId": "[parameters('appServiceResourceId')]",
                                            "timeContext": {
                                                "durationMs": 3600000,
                                                "grain": 60000
                                            },
                                            "metrics": [
                                                {
                                                    "resourceMetadata": {
                                                        "id": "[parameters('appServiceResourceId')]"
                                                    },
                                                    "name": "MemoryWorkingSet",
                                                    "aggregationType": "Average",
                                                    "displayName": "Memory (MB)"
                                                }
                                            ]
                                        }
                                    }
                                }
                            },
                            {
                                "position": {
                                    "x": 0,
                                    "y": 7,
                                    "colSpan": 9,
                                    "rowSpan": 1
                                },
                                "metadata": {
                                    "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                    "settings": {
                                        "content": {
                                            "content": "## üéØ SLO Thresholds\n| Metric | Target | Current | Status |\n|--------|--------|---------|--------|\n| p95 Response Time | < 2000ms | _Live_ | üü¢ |\n| Error Rate | < 1% | _Live_ | üü¢ |\n| Availability | > 99.9% | _Live_ | üü¢ |",
                                            "title": "",
                                            "subtitle": "",
                                            "markdownSource": 1
                                        }
                                    }
                                }
                            }
                        ]
                    }
                ],
                "metadata": {
                    "model": {
                        "timeRange": {
                            "value": {
                                "relative": {
                                    "duration": 1,
                                    "timeUnit": 1
                                }
                            },
                            "type": "MsPortalFx.Composition.Configuration.ValueTypes.TimeRange"
                        }
                    }
                }
            }
        }
    ],
    "outputs": {
        "dashboardId": {
            "type": "string",
            "value": "[variables('dashboardId')]"
        },
        "dashboardUrl": {
            "type": "string",
            "value": "[concat('https://portal.azure.com/#@', subscription().tenantId, '/dashboard/', variables('dashboardId'))]"
        }
    }
}